# 📊 Flowable 父子流程同步实现方案对比

## 1. 执行监听器方案（ExecutionListener）

### 原理

- 在 **父流程 UserTask 的 end 事件** 上挂 `ExecutionListener`。
- 当父任务完成时触发监听器逻辑 → 根据 `decision` 判断是推进还是退回 → 同步对子流程操作。

### 特点

✅ 优点

- 逻辑和流程引擎紧密结合，自动触发，无需业务层显式调用。
- 写法简洁，只要完成父任务，子流程自动同步。
- 适合“流程逻辑固定”的场景（父子节点一一对应）。

❌ 缺点

- 只能监听 **节点执行事件**，对“操作人、审批意见”等和任务相关的上下文支持较弱。
- 对业务层来说，控制能力不够直观，调试也要看监听器日志。

### 适用场景

- 流程逻辑比较固化，父子流程始终同步。
- 你希望“父任务完成 → 自动触发子流程同步”，不用额外写控制层逻辑。

------

## 2. 任务监听器方案（TaskListener）

### 原理

- 在 **父流程 UserTask 的 complete 事件** 上挂 `TaskListener`。
- 当父任务完成时触发 → 判断操作类型（退回 / 审批通过） → 同步子流程。

### 特点

✅ 优点

- 更贴近任务维度，能直接获取操作人、意见等信息（通过 `DelegateTask`）。
- 对“退回/同意”等业务操作区分更灵活。
- 对日志审计更友好（可以记录办理人、操作意见）。

❌ 缺点

- 和流程图绑定较多，每个 UserTask 节点都要加 TaskListener。
- 如果任务节点较多，配置比较繁琐。

### 适用场景

- 父子流程同步逻辑不仅跟环节有关，还需要结合 **操作人、意见、变量** 等任务上下文。
- 需要审计、记录办理日志的场景。

------

## 3. 无监听器方案（业务层驱动）

### 原理

- **不依赖监听器**。
- 在业务层（如 Controller）写接口，显式调用：
  - 完成父任务时，手动同步完成子任务；
  - 父退回时，手动调用 `ChangeActivityStateBuilder` 退回子流程。

### 特点

✅ 优点

- 完全由业务层控制，逻辑最清晰直观。
- 灵活性最高，可以根据实际业务动态决定子流程怎么走。
- 调试最简单，接口调用 → 直接看效果。

❌ 缺点

- 需要在业务层维护更多代码，流程逻辑分散到 Controller/Service。
- 不够“流程驱动”，容易和业务代码耦合。

### 适用场景

- 复杂业务，需要在接口里动态决定子流程行为。
- 对父子流程同步有更复杂的逻辑（不止是简单的推进 / 退回）。
- 想要避免监听器带来的“黑盒效果”，更倾向显式控制。

------

## 📋 总体对比表

| 方案           | 触发点                         | 能获取的信息             | 优点                      | 缺点                         | 适用场景                       |
| -------------- | ------------------------------ | ------------------------ | ------------------------- | ---------------------------- | ------------------------------ |
| **执行监听器** | 节点执行事件 (start/end)       | 流程变量、活动ID         | 自动触发，写法简洁        | 任务上下文弱，日志不直观     | 固化流程，父子同步固定         |
| **任务监听器** | 用户任务事件 (create/complete) | 任务、办理人、意见、变量 | 可区分退回/同意，支持审计 | 配置繁琐，每个UserTask都要加 | 审批类场景，需要记录操作日志   |
| **无监听器**   | 业务接口层（显式调用）         | 业务上下文、任意变量     | 灵活、直观、易调试        | 代码量大、流程逻辑外置       | 复杂业务逻辑，父子流程耦合松散 |

------

## 🧭 选择建议

- **如果你要一个“标准审批流”，父子流程始终保持一致 → 用 执行监听器方案**（自动触发，最少代码）。
- **如果你需要记录操作人、操作意见，区分退回/同意/转办等操作 → 用 任务监听器方案**（更贴合业务场景）。
- **如果你的业务逻辑复杂（比如部分子流程不同步，或不同父任务对应不同子任务策略） → 用 无监听器方案**（控制权交给业务层，最灵活）。